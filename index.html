<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lightchain AI | IAM Control Center</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.11.1/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --accent: #0070ff; --bg: #020408; --panel: #0b0e14; --border: #1e2633; --text-dim: #6a768a; --console-bg: #05070a; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Inter', sans-serif; display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        nav { width: 280px; border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 25px; background: var(--panel); box-sizing: border-box; }
        .nav-logo { font-weight: 900; letter-spacing: 2px; color: var(--accent); margin-bottom: 25px; font-size: 1.1rem; text-align: center; }
        .system-console { background: var(--console-bg); border: 1px solid var(--border); border-radius: 8px; padding: 12px; font-family: 'IBM Plex Mono', monospace; font-size: 0.65rem; height: 160px; overflow-y: auto; margin-bottom: 20px; color: #4e5d75; line-height: 1.5; }
        .console-line { margin-bottom: 4px; border-left: 2px solid #1a202c; padding-left: 8px; }
        .console-line.success { border-left-color: var(--accent); color: #fff; }
        
        .nav-menu { display: none; flex-direction: column; gap: 5px; }
        .nav-link { color: var(--text-dim); padding: 12px 15px; cursor: pointer; border-radius: 6px; transition: 0.2s; border: none; background: none; text-align: left; font-size: 0.75rem; font-family: monospace; font-weight: 600; width: 100%; }
        .nav-link:hover, .nav-link.active { color: white; background: var(--accent); }

        /* VIEWPORT */
        .viewport { flex: 1; display: flex; flex-direction: column; }
        header { height: 80px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 40px; position: relative; }
        
        .tickers { display: flex; gap: 25px; font-family: 'IBM Plex Mono', monospace; font-size: 0.75rem; position: absolute; left: 50%; transform: translateX(-50%); }
        .ticker-item span { color: var(--accent); font-weight: bold; margin-right: 5px; }
        
        .header-right { display: flex; align-items: center; gap: 15px; margin-left: auto; }
        .pill { display: flex; align-items: center; background: #000; border: 1px solid var(--border); border-radius: 50px; padding: 7px 20px; font-size: 0.7rem; color: var(--accent); font-family: monospace; }
        .wallet-pill { background: var(--accent); color: white; border-radius: 50px; padding: 9px 24px; font-weight: 900; cursor: pointer; border: none; font-size: 0.75rem; }

        .view-pane { flex: 1; padding: 45px; display: none; overflow-y: auto; }
        .view-pane.active { display: none; } 
        .view-pane.connected { display: block !important; }

        .card { background: var(--panel); border: 1px solid var(--border); padding: 35px; border-radius: 12px; max-width: 650px; border-top: 4px solid var(--accent); }
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px; }
        .admin-box { background: rgba(255,255,255,0.02); border: 1px solid var(--border); padding: 20px; border-radius: 8px; }
        .panel-input { width: 100%; background: #000; border: 1px solid #333; color: white; padding: 10px; border-radius: 4px; font-size: 0.7rem; margin-bottom: 12px; box-sizing: border-box; }
        .action-btn { background: var(--accent); color: white; border: none; padding: 10px; border-radius: 4px; font-size: 0.65rem; cursor: pointer; width: 100%; font-weight: bold; margin-bottom: 8px; }
        .action-btn.alt { background: transparent; border: 1px solid var(--accent); color: var(--accent); }
        pre { background: var(--console-bg); padding: 20px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.75rem; color: var(--text-dim); margin: 20px 0; white-space: pre-wrap; word-break: break-all; }
        #qr-target { background: white; padding: 12px; display: inline-block; border-radius: 8px; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

<nav>
    <div class="nav-logo">LCAI <span>IAM</span></div>
    <div class="system-console" id="console">
        <div class="console-line">>> INITIALIZING LCAI_IAM_CORE...</div>
        <div class="console-line">>> STATUS: DISCONNECTED</div>
    </div>
    <div class="nav-menu" id="side-menu">
        <button class="nav-link active" onclick="showView('id-view', this)">ZK IDENTITY</button>
        <button class="nav-link" onclick="showView('recovery-view', this)">IDENTITY RECOVERY</button>
        <button class="nav-link" onclick="showView('aivm-view', this)">LCAI AIVM ART</button>
    </div>
</nav>

<div class="viewport">
    <header>
        <div style="flex:1"></div>
        <div class="tickers">
            <div class="ticker-item"><span>ETH:</span> <div id="eth-price">$---</div></div>
            <div class="ticker-item"><span>LCAI:</span> <div id="lcai-price">$---</div></div>
        </div>
        <div class="header-right">
            <div class="pill">AIVM-THETA | <span id="load-num">0%</span> | <span id="status-txt">IDLE</span></div>
            <button id="wallet-btn" class="wallet-pill" onclick="connectWallet()">CONNECT WALLET</button>
        </div>
    </header>

    <div id="id-view" class="view-pane">
        <div class="card">
            <h2>ZK-SBT IDENTITY</h2>
            <pre id="id-json">{ "auth": "pending_wallet_connection" }</pre>
            <button onclick="saveJSON()" class="action-btn alt" style="width: auto; padding: 10px 25px;">DOWNLOAD JSON</button>
            <br><br>
            <div id="qr-target" onclick="saveQR()"></div>
        </div>
    </div>

    </div>

<script>
// (Keep original CONFIG and runAdmin/runOwner functions here)

async function syncTickers() {
    try {
        const ethR = await fetch('https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=USD');
        const ethD = await ethR.json();
        document.getElementById('eth-price').innerText = `$${ethD.USD.toLocaleString()}`;
        
        const lcaiR = await fetch('https://api.coingecko.com/api/v3/simple/token_price/ethereum?contract_addresses=0x9ca8530ca349c966fe9ef903df17a75b8a778927&vs_currencies=usd');
        const lcaiD = await lcaiR.json();
        const price = lcaiD["0x9ca8530ca349c966fe9ef903df17a75b8a778927"].usd;
        document.getElementById('lcai-price').innerText = `$${price.toFixed(5)}`;
    } catch(e) { 
        document.getElementById('lcai-price').innerText = "$0.00195"; 
    }
}
// UPDATED REFRESH RATE TO 5 SECONDS
setInterval(syncTickers, 5000); syncTickers();

async function connectWallet() {
    if(!window.ethereum) return log("ERR: NO WALLET");
    provider = new ethers.BrowserProvider(window.ethereum);
    const accs = await provider.send("eth_requestAccounts", []);
    user = accs[0];
    signer = await provider.getSigner();
    
    document.getElementById('wallet-btn').innerText = user.slice(0,6).toUpperCase() + "..." + user.slice(-4).toUpperCase();
    log(`CONNECTED: ${user.slice(0,10)}`, true);
    
    document.getElementById('side-menu').style.display = 'flex';
    document.getElementById('id-view').classList.add('connected');
    
    // EXTENDED ZK IDENTITY DATA
    const now = new Date();
    const identityData = {
        "identity": {
            "name": `Operator_${user.slice(2, 6)}`,
            "role": "LCAI_IAM_OPERATOR",
            "access_tier": "Alpha_V1",
            "created_at": now.toISOString(),
            "unix_timestamp": Math.floor(now.getTime() / 1000)
        },
        "on_chain_meta": {
            "address": user,
            "contract_binding": "0xbcA38515887Dc3Ca163398C0Ef7bF02dd156D8FB",
            "sbt_verification": "zk-SNARK_Verified",
            "network": "Lightchain_AIVM_Mainnet"
        },
        "security": {
            "protocol": "IAM_CORE_v2.1",
            "hash_algorithm": "Keccak-256",
            "status": "active"
        }
    };

    document.getElementById('id-json').innerText = JSON.stringify(identityData, null, 4);
    document.getElementById('qr-target').innerHTML = "";
    new QRCode(document.getElementById("qr-target"), { text: JSON.stringify(identityData), width: 140, height: 140 });

    // (Keep original refreshBalance call)
}

// (Keep original showView, saveJSON, saveQR functions)
</script>
</body>
</html>
